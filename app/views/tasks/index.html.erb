<h1>Your Tasks</h1>
<%= link_to 'New Task', new_task_path, class: "btn btn-success mb-3" %>
<%= form_with url: tasks_path, method: :get, local: true, class: "mb-3" do %>
  <div class="row g-2 align-items-center">
    <div class="col-auto">
      <%= label_tag :category_id, "Filter by Category:" %>
    </div>
    <div class="col-auto">
      <%= select_tag :category_id, options_from_collection_for_select(current_user.categories, :id, :name, params[:category_id]), include_blank: "All Categories", class: "form-select" %>
    </div>
    <div class="col-auto">
      <%= submit_tag "Filter", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>
<% if params[:category_id].present? && current_user.categories.exists?(params[:category_id]) %>
  <p>Showing tasks for category: <strong><%= current_user.categories.find(params[:category_id]).name %></strong></p>
<% end %>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Category</th>
      <th>Due Date</th>
      <th>Completed</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= task.title %></td>
        <td><%= task.category.name if task.category %></td>
        <td><%= task.due_date %></td>
        <td>
          <% if task.completed %>
            <span class="badge bg-success">Yes</span>
          <% else %>
            <span class="badge bg-secondary">No</span>
          <% end %>
        </td>
        <td><%= link_to 'Show', task, class: "btn btn-info btn-sm" %></td>
        <td><%= link_to 'Edit', edit_task_path(task), class: "btn btn-warning btn-sm" %></td>
        <td><%= link_to 'Delete', task_path(task), 
                data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, 
                class: "btn btn-danger btn-sm" %></td>
      </tr>
    <% end %>
  </tbody>
</table>
